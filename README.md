# MRM Manager

ابزاری برای مدیریت، پشتیبان‌گیری و مهاجرت پنل‌های پروکسی  
(پاسارگارد، ربکا و مرزبان)

---

## ۱. نصب

روی سرور (به‌صورت کاربر روت یا با sudo) این دستور را اجرا کنید:

```bash
sudo bash -c "$(curl -sL https://raw.githubusercontent.com/Mohammad1724/mrm-ssl-pasarguard/main/manager/install.sh)"
```

بعد از اتمام نصب، برنامه با دستور زیر اجرا می‌شود:

```bash
mrm
```

---

## ۲. چه کارهایی انجام می‌دهد؟

### ۲.۱. SSL و دامنه

- دریافت و تمدید گواهی SSL با استفاده از Let’s Encrypt
- تنظیم SSL برای:
  - دامنه پنل
  - دامنه ساب / لینک اشتراک
  - نودها (Node)
- امکان تفکیک دامنه:
  - یک دامنه برای داشبورد
  - یک دامنه جدا برای لینک‌های اشتراک (اصلی برای کاربران)

### ۲.۲. بکاپ و بازیابی

- ساخت بکاپ کامل از:
  - فایل‌های کانفیگ پنل
  - دیتابیس
  - پوشه‌های مهم داده
- ذخیره بکاپ در سرور (پوشه `/root/mrm-backups`)
- ارسال خودکار بکاپ به تلگرام (ربات + Chat ID)
- زمان‌بندی اتوماتیک:
  - هر ۶ ساعت
  - روزانه
- امکان اجرای دستی بکاپ از داخل منو

### ۲.۳. مهاجرت (Migration)

- مهاجرت از Pasarguard به Rebecca
- پشتیبانی از دیتابیس‌های:
  - TimescaleDB / PostgreSQL
  - SQLite
  - MySQL / MariaDB
- تبدیل خودکار ساختار دیتابیس به MySQL مخصوص Rebecca
- انتقال تنظیمات مهم و گواهی‌ها
- ایجاد بکاپ قبل از مهاجرت و امکان رول‌بک (برگشت در صورت نیاز)

### ۲.۴. ابزارهای جانبی

- ساخت Inbound از طریق منو:
  - VLESS + Reality
  - TLS (VLESS / VMess / Trojan)
  - NoTLS / CDN
- مدیریت صفحه اشتراک (Theme):
  - نصب قالب آماده
  - خواندن تنظیمات قبلی از قالب قدیمی
- سایت فیک (Fake Site) روی پورت ۸۰:
  - چند قالب آماده (شرکتی، شخصی، گیمینگ و ...)
  - امکان ویرایش دستی HTML
- مدیریت پورت‌ها:
  - تک پورت (همه چیز روی ۴۴۳)
  - دو پورت (پورت جدا برای پنل / ساب)
- مدیریت سرویس‌ها و ادمین‌ها:
  - ریستارت پنل و نود
  - ساخت / حذف / تغییر رمز ادمین از طریق CLI پنل

---

## ۳. ساختار منوها

پس از اجرای `mrm` منوی اصلی شبیه این است:

- ۱) SSL Certificates  
  مدیریت دریافت و تنظیم SSL برای پنل، نود و دامنهٔ کانفیگ.

- ۲) Backup & Restore  
  بکاپ‌گیری، تنظیم تلگرام، زمان‌بندی خودکار.

- ۳) Tools & Settings  
  - سایت فیک (Nginx)
  - تفکیک دامنه (Domain Separator)
  - مدیریت پورت‌ها
  - تم صفحه اشتراک (Theme)
  - ویزارد ساخت Inbound
  - ابزار مهاجرت Pasarguard → Rebecca
  - ویرایش فایل‌های `.env` پنل و نود
  - ریستارت سرویس‌ها

- ۴) Admin & Service Control (در صورت فعال بودن)  
  - ریستارت / توقف / راه‌اندازی مجدد پنل
  - مشاهده لاگ‌ها
  - ساخت و مدیریت ادمین‌ها

- ۰) خروج از برنامه

---

## ۴. محل نصب و فایل‌ها

پس از نصب، فایل‌های برنامه در این مسیر قرار می‌گیرند:

```text
/opt/mrm-manager/
  ├── main.sh             # منوی اصلی
  ├── utils.sh            # توابع مشترک (ریستارت سرویس، شناسایی پنل و ...)
  ├── ssl.sh              # مدیریت SSL
  ├── backup.sh           # بکاپ‌گیری + ارسال تلگرام
  ├── migrator.sh         # مهاجرت Pasarguard → Rebecca
  ├── inbound.sh          # ساخت اینباند (Reality / TLS / CDN)
  ├── theme.sh            # مدیریت قالب صفحه اشتراک
  ├── site.sh             # سایت فیک (کَمُفلاژ)
  ├── domain_separator.sh # تفکیک دامنه
  ├── port_manager.sh     # مدیریت پورت‌ها
  ├── node.sh             # نمایش و مدیریت SSL نود
  └── ui.sh               # توابع رابط کاربری (ظاهر ترمینال)
```

یک شورتکات نیز به این صورت ساخته می‌شود:

- `/usr/local/bin/mrm`  →  اجرای مستقیم منو

---

## ۵. پنل‌های پشتیبانی‌شده

اسکریپت به صورت خودکار سعی می‌کند پنل را تشخیص دهد:

- اگر `/opt/rebecca` موجود باشد → Rebecca
- اگر `/opt/pasarguard` موجود باشد → Pasarguard
- در غیر این صورت → Marzban (پیش‌فرض)

برخی امکانات (مثل مهاجرت) مخصوص Pasarguard → Rebecca طراحی شده‌اند.

---

## ۶. نکات و توصیه‌ها

- قبل از هر نوع مهاجرت، حتماً یک بار از قسمت **Backup & Restore** بکاپ بگیرید.
- برای SSL:
  - پورت ۸۰ باید برای گرفتن گواهی باز باشد.
  - دامنه باید به IP سرور اشاره کند.
- برای بکاپ تلگرام:
  - از `@BotFather` توکن بگیرید.
  - با `@userinfobot` آیدی عددی خود را پیدا کنید.
- در صورت خطا در هر قسمت:
  - لاگ‌ها را بررسی کنید (معمولاً در `docker compose logs` یا `journalctl`).

---

## ۷. گزارش باگ و مشارکت

اگر:

- باگی پیدا کردید  
- پیشنهادی برای بهبود دارید  
- یا می‌خواهید در توسعهٔ اسکریپت کمک کنید

از طریق بخش Issues در گیت‌هاب پیام بدهید:

`https://github.com/Mohammad1724/mrm-ssl-pasarguard/issues`

---

## ۸. لایسنس

این پروژه تحت لایسنس MIT منتشر شده است.  
استفاده، تغییر و انتشار آن به‌صورت آزاد مجاز است.
```