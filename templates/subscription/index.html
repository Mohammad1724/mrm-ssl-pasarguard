<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#f5f5f5" id="themeColor">
    <title>__BRAND__</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700;900&display=swap');

        /* --- VARIABLES (Light Default) --- */
        :root {
            --bg: #f8fafc; --txt: #0f172a; --mute: #64748b;
            --card: #ffffff; --brd: #e2e8f0;
            --pri: #0ea5e9;
            --nav-h: 60px; /* Height of the news ticker */
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
        }
        /* DARK MODE */
        :root.dark {
            --bg: #0f172a; --txt: #f1f5f9; --mute: #94a3b8;
            --card: #1e293b; --brd: #334155;
            --pri: #38bdf8;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

        body {
            font-family: 'Vazirmatn', sans-serif;
            background: var(--bg); color: var(--txt);
            /* ÙØ§ØµÙ„Ù‡ Ø²ÛŒØ§Ø¯ Ø§Ø² Ø¨Ø§Ù„Ø§ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² ØªØ¯Ø§Ø®Ù„ Ø¨Ø§ Ù†ÙˆØ§Ø± Ø®Ø¨Ø± */
            padding-top: calc(var(--nav-h) + 30px);
            padding-bottom: 30px;
            padding-left: 20px;
            padding-right: 20px;
            min-height: 100vh;
            overflow-x: hidden;
            transition: background 0.3s, color 0.3s;
        }

        /* --- FIXED TOP BAR (NEWS) --- */
        .ticker-wrap {
            position: fixed; top: 0; left: 0; right: 0;
            height: var(--nav-h);
            background: var(--card);
            border-bottom: 1px solid var(--brd);
            display: flex; align-items: center;
            z-index: 9999; /* Ø¨Ø§Ù„Ø§ØªØ±ÛŒÙ† Ù„Ø§ÛŒÙ‡ */
            box-shadow: var(--shadow);
        }
        
        .ticker-icon {
            width: 60px; height: 100%;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; color: white;
            flex-shrink: 0;
        }

        .ticker-content {
            flex: 1; overflow: hidden; white-space: nowrap;
            position: relative; height: 100%;
            display: flex; align-items: center;
        }
        
        /* Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø±Ø§Ø³Øª Ú†ÛŒÙ† */
        .ticker-content span {
            display: inline-block;
            font-weight: 600; font-size: 14px;
            padding-left: 100%; /* Ø´Ø±ÙˆØ¹ Ø§Ø² Ø¨ÛŒØ±ÙˆÙ† Ú©Ø§Ø¯Ø± */
            animation: ticker 20s linear infinite;
        }
        
        @keyframes ticker {
            0% { transform: translate3d(0, 0, 0); }
            100% { transform: translate3d(-200%, 0, 0); }
        }

        /* --- MAIN CONTAINER --- */
        .con { max-width: 800px; margin: 0 auto; width: 100%; }

        /* HEADER (Brand & Theme) */
        .head { 
            display: flex; justify-content: space-between; align-items: center; 
            margin-bottom: 25px; 
            position: relative; z-index: 1; /* Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø¯ÛŒØ¯Ù‡ Ø´Ø¯Ù† */
        }
        
        .brand-box { display: flex; flex-direction: column; gap: 4px; }
        
        .brand {
            font-size: 28px; font-weight: 900;
            background: linear-gradient(135deg, var(--pri), #8b5cf6);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            line-height: 1.2;
        }

        .bot-link {
            font-size: 13px; color: var(--mute); text-decoration: none;
            background: var(--brd); padding: 4px 12px; border-radius: 20px;
            display: inline-block; width: fit-content; font-weight: 500;
        }

        .theme-btn {
            width: 45px; height: 45px;
            border-radius: 14px; border: 1px solid var(--brd);
            background: var(--card); color: var(--txt);
            font-size: 20px; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            box-shadow: var(--shadow);
            transition: 0.2s;
        }
        .theme-btn:active { transform: scale(0.9); }

        /* CARDS */
        .card {
            background: var(--card); border: 1px solid var(--brd);
            border-radius: 24px; padding: 25px;
            box-shadow: var(--shadow);
        }

        .grid { display: grid; gap: 30px; }
        @media (min-width: 768px) { .grid { grid-template-columns: 1fr 1fr; } }

        /* PROFILE SECTION */
        .prof-row { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; padding-bottom: 20px; border-bottom: 1px solid var(--brd); }
        
        .av {
            width: 70px; height: 70px; border-radius: 50%;
            background: linear-gradient(135deg, #e0f2fe, #bae6fd); color: #0369a1;
            display: flex; align-items: center; justify-content: center; font-size: 30px;
            position: relative; flex-shrink: 0;
        }
        :root.dark .av { background: linear-gradient(135deg, #334155, #475569); color: #cbd5e1; }
        
        .dot { position: absolute; bottom: 2px; right: 2px; width: 16px; height: 16px; background: #22c55e; border: 3px solid var(--card); border-radius: 50%; }

        .nm { font-size: 19px; font-weight: 800; margin-bottom: 4px; }
        .st { font-size: 12px; padding: 4px 10px; border-radius: 8px; font-weight: 700; background: var(--brd); color: var(--mute); }
        .st.act { background: rgba(34, 197, 94, 0.1); color: #16a34a; }
        
        /* USAGE BARS */
        .bars { display: flex; flex-direction: column; gap: 20px; margin-bottom: 25px; }
        .bar-item { display: flex; flex-direction: column; gap: 8px; }
        .bar-head { display: flex; justify-content: space-between; font-size: 13px; font-weight: 700; }
        .bar-track { width: 100%; height: 10px; background: var(--brd); border-radius: 10px; overflow: hidden; }
        .bar-fill { height: 100%; border-radius: 10px; transition: width 0.8s ease; width: 0%; }
        
        /* BUTTONS */
        .btn {
            width: 100%; height: 50px; border: none; border-radius: 14px;
            font-size: 14px; font-weight: 700; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 8px;
            transition: 0.2s; text-decoration: none;
        }
        .btn:active { transform: scale(0.97); }

        .btn-p { background: var(--pri); color: white; box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3); }
        .btn-s { background: var(--brd); color: var(--txt); }
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px; }

        /* STATS GRID */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 25px; }
        .stat-box { background: var(--brd); padding: 15px; border-radius: 16px; text-align: center; }
        .stat-lbl { font-size: 12px; color: var(--mute); margin-bottom: 5px; }
        .stat-val { font-size: 16px; font-weight: 800; direction: ltr; }

        /* DOWNLOADS */
        .dl-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; border-top: 1px solid var(--brd); padding-top: 20px; margin-top: 20px; }
        .dl-item { 
            display: flex; flex-direction: column; align-items: center; gap: 6px; 
            padding: 10px; border-radius: 12px; cursor: pointer; color: var(--mute); 
            font-size: 11px; font-weight: 600; transition: 0.2s;
        }
        .dl-item:hover { background: var(--brd); color: var(--txt); }
        .dl-icon { font-size: 22px; }

        /* MODALS */
        .mod { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.6); 
            backdrop-filter: blur(5px); z-index: 10000;
            display: none; align-items: center; justify-content: center; padding: 20px;
        }
        .mbox { 
            background: var(--card); width: 100%; max-width: 400px; 
            border-radius: 24px; padding: 25px; box-shadow: var(--shadow);
            max-height: 90vh; overflow-y: auto; text-align: center;
        }
        .tst {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(20px);
            background: #10b981; color: white; padding: 10px 24px; border-radius: 30px;
            font-weight: 700; opacity: 0; transition: 0.3s; z-index: 11000;
        }
        .tst.sh { opacity: 1; transform: translateX(-50%) translateY(0); }
        
        #cph { position: absolute; left: -9999px; }

        /* TABS */
        .tabs { display: flex; background: var(--brd); padding: 4px; border-radius: 12px; margin-bottom: 15px; }
        .tab { flex: 1; padding: 10px; border-radius: 10px; border: none; background: transparent; color: var(--mute); cursor: pointer; font-weight: 600; font-size: 13px; }
        .tab.active { background: var(--card); color: var(--txt); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .tab-content { display: none; text-align: right; }
        .tab-content.active { display: block; }
        
        .step { background: var(--brd); padding: 12px; border-radius: 12px; margin-bottom: 10px; display: flex; gap: 12px; }
        .step-num { width: 24px; height: 24px; background: var(--pri); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; flex-shrink: 0; }
        .step-txt strong { display: block; font-size: 13px; margin-bottom: 2px; }
        .step-txt p { font-size: 12px; color: var(--mute); margin: 0; }
    </style>
</head>
<body>
    <div class="ticker-wrap">
        <div class="ticker-icon">ğŸ“¢</div>
        <div class="ticker-content"><span id="nT">__NEWS__</span></div>
    </div>

    <div class="tst" id="toast">Ú©Ù¾ÛŒ Ø´Ø¯!</div>
    <input type="text" id="cph" readonly>

    <div class="con">
        <!-- HEADER -->
        <div class="head">
            <div class="brand-box">
                <div class="brand">User Panel</div>
                <a href="https://t.me/__BOT__" class="bot-link">@__BOT__</a>
            </div>
            <button class="theme-btn" id="themeBtn">ğŸŒ™</button>
        </div>

        <div class="card">
            <div class="grid">
                <!-- LEFT SIDE -->
                <div>
                    <!-- Profile -->
                    <div class="prof-row">
                        <div class="av">ğŸ‘¤ {% if user.online_at %}<div class="dot"></div>{% endif %}</div>
                        <div>
                            <div class="nm">{{ user.username }}</div>
                            <span class="st {% if user.status.name == 'active' %}act{% endif %}">
                                {% if user.status.name == 'active' %}ÙØ¹Ø§Ù„{% else %}ØºÛŒØ±ÙØ¹Ø§Ù„{% endif %}
                            </span>
                        </div>
                    </div>

                    <!-- Usage Bars -->
                    <div class="bars">
                        <div class="bar-item">
                            <div class="bar-head"><span>Ø­Ø¬Ù… Ù…ØµØ±ÙÛŒ</span><span id="usageTxt">0%</span></div>
                            <div class="bar-track"><div class="bar-fill" id="usageFill" style="background: #3b82f6;"></div></div>
                            <div class="bar-head" style="font-weight:400;color:var(--mute);margin-top:2px"><small id="usageLbl">...</small></div>
                        </div>
                        <div class="bar-item">
                            <div class="bar-head"><span>Ø§Ø¹ØªØ¨Ø§Ø± Ø²Ù…Ø§Ù†ÛŒ</span><span id="timeTxt">0%</span></div>
                            <div class="bar-track"><div class="bar-fill" id="timeFill" style="background: #10b981;"></div></div>
                            <div class="bar-head" style="font-weight:400;color:var(--mute);margin-top:2px"><small id="timeLbl">...</small></div>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="btn-grid">
                        <button class="btn btn-s" onclick="copy('{{ subscription_url }}', this)">ğŸ“‹ Ú©Ù¾ÛŒ Ù„ÛŒÙ†Ú©</button>
                        <button class="btn btn-s" onclick="modal('qrMod')">ğŸ”³ Ø§Ø³Ú©Ù† QR</button>
                    </div>
                    <button class="btn btn-p" onclick="modal('connectMod')">ğŸš€ Ø§ØªØµØ§Ù„ Ø³Ø±ÛŒØ¹</button>
                    <div class="btn-grid" style="margin-top:12px">
                        <button class="btn btn-s" onclick="modal('tutMod')">ğŸ“– Ø¢Ù…ÙˆØ²Ø´</button>
                        <a href="https://t.me/__SUP__" class="btn btn-s" style="justify-content:center">ğŸ’¬ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ</a>
                    </div>
                </div>

                <!-- RIGHT SIDE -->
                <div style="display:flex; flex-direction:column; justify-content:space-between;">
                    <div>
                        <div class="stats-grid">
                            <div class="stat-box">
                                <div class="stat-lbl">Ø§Ù†Ù‚Ø¶Ø§</div>
                                <div class="stat-val" id="expDate">...</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-lbl">Ø­Ø¬Ù… Ú©Ù„</div>
                                <div class="stat-val" id="totalVol">...</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-lbl">Ù…ØµØ±Ù Ø´Ø¯Ù‡</div>
                                <div class="stat-val" id="usedVol">...</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-lbl">Ø¨Ø§Ù‚ÛŒÙ…Ø§Ù†Ø¯Ù‡</div>
                                <div class="stat-val" id="remVol" style="color:var(--pri)">...</div>
                            </div>
                        </div>

                        <div class="dl-grid">
                            <div class="dl-item" id="dl-and" onclick="modal('dlAnd')">
                                <div class="dl-icon">ğŸ¤–</div><span>Android</span>
                            </div>
                            <div class="dl-item" id="dl-ios" onclick="modal('dlIos')">
                                <div class="dl-icon">ğŸ</div><span>iOS</span>
                            </div>
                            <div class="dl-item" id="dl-win" onclick="modal('dlWin')">
                                <div class="dl-icon">ğŸ’»</div><span>Windows</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align:center; margin-top:20px; font-weight:900; font-size:24px; opacity:0.1; letter-spacing:2px">
                        __BRAND__
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    
    <!-- Connect Modal -->
    <div class="mod" id="connectMod" onclick="if(event.target===this)closeModal()">
        <div class="mbox">
            <h3>Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ø±Ù†Ø§Ù…Ù‡</h3><br>
            <div style="display:grid; gap:10px">
                <button class="btn btn-s" onclick="openUri('v2rayng')">v2rayNG (Android)</button>
                <button class="btn btn-s" onclick="openUri('streisand')">Streisand (iOS)</button>
                <button class="btn btn-s" onclick="openUri('hiddify')">Hiddify (All)</button>
                <button class="btn btn-s" onclick="copy('{{ subscription_url }}')">Ú©Ù¾ÛŒ Ù„ÛŒÙ†Ú© Ú©Ù„ÛŒ</button>
            </div>
            <br><button class="btn btn-s" style="background:var(--brd)" onclick="closeModal()">Ø¨Ø³ØªÙ†</button>
        </div>
    </div>

    <!-- Tutorial Modal -->
    <div class="mod" id="tutMod" onclick="if(event.target===this)closeModal()">
        <div class="mbox" style="text-align:right">
            <h3 style="text-align:center;margin-bottom:15px">Ø±Ø§Ù‡Ù†Ù…Ø§</h3>
            <div class="tabs">
                <button class="tab active" onclick="setTab('and')">Ø§Ù†Ø¯Ø±ÙˆÛŒØ¯</button>
                <button class="tab" onclick="setTab('ios')">Ø¢ÛŒÙÙˆÙ†</button>
                <button class="tab" onclick="setTab('win')">ÙˆÛŒÙ†Ø¯ÙˆØ²</button>
            </div>
            
            <div id="tab-and" class="tab-content active">
                <div class="step"><div class="step-num">1</div><div class="step-txt"><strong>Ù†ØµØ¨ v2rayNG</strong><p>Ø§Ø² Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÛŒÙ† Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯</p></div></div>
                <div class="step"><div class="step-num">2</div><div class="step-txt"><strong>Ú©Ù¾ÛŒ Ù„ÛŒÙ†Ú©</strong><p>Ù„ÛŒÙ†Ú© Ø§Ø´ØªØ±Ø§Ú© Ø±Ø§ Ú©Ù¾ÛŒ Ú©Ù†ÛŒØ¯</p></div></div>
                <div class="step"><div class="step-num">3</div><div class="step-txt"><strong>Ø§ÙØ²ÙˆØ¯Ù†</strong><p>Ø¯Ø± Ø¨Ø±Ù†Ø§Ù…Ù‡ â˜° Ø³Ù¾Ø³ Subscription settings Ùˆ +</p></div></div>
            </div>
            <div id="tab-ios" class="tab-content">
                <div class="step"><div class="step-num">1</div><div class="step-txt"><strong>Ù†ØµØ¨ Streisand</strong><p>Ø§Ø² Ø§Ù¾ Ø§Ø³ØªÙˆØ± Ù†ØµØ¨ Ú©Ù†ÛŒØ¯</p></div></div>
                <div class="step"><div class="step-num">2</div><div class="step-txt"><strong>Ø§ÙØ²ÙˆØ¯Ù†</strong><p>Ø¯Ú©Ù…Ù‡ + Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯ Ùˆ Import from clipboard</p></div></div>
            </div>
            <div id="tab-win" class="tab-content">
                <div class="step"><div class="step-num">1</div><div class="step-txt"><strong>Ù†ØµØ¨ v2rayN</strong><p>Ù†Ø³Ø®Ù‡ zip Ø±Ø§ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ùˆ Ø§Ú©Ø³ØªØ±Ú©Øª Ú©Ù†ÛŒØ¯</p></div></div>
                <div class="step"><div class="step-num">2</div><div class="step-txt"><strong>Ù¾ÛŒØ³Øª</strong><p>Ctrl+V Ø±Ø§ Ø¯Ø± Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¨Ø²Ù†ÛŒØ¯</p></div></div>
            </div>
            <br><button class="btn btn-s" onclick="closeModal()">Ø¨Ø³ØªÙ†</button>
        </div>
    </div>
    
    <!-- QR Modal -->
    <div class="mod" id="qrMod" onclick="if(event.target===this)closeModal()">
        <div class="mbox">
            <div style="background:white; padding:15px; border-radius:16px; display:inline-block">
                <img id="qrImg" src="" width="200" style="display:block">
            </div>
            <br><br><button class="btn btn-s" onclick="closeModal()">Ø¨Ø³ØªÙ†</button>
        </div>
    </div>
    
    <!-- Downloads (Simplified) -->
    <div class="mod" id="dlAnd" onclick="if(event.target===this)closeModal()"><div class="mbox"><h3>Ø§Ù†Ø¯Ø±ÙˆÛŒØ¯</h3><br><a href="https://play.google.com/store/apps/details?id=com.v2ray.ang" class="btn btn-s" target="_blank" style="margin-bottom:10px">v2rayNG</a><a href="https://play.google.com/store/apps/details?id=app.hiddify.com" class="btn btn-s" target="_blank">Hiddify</a><br><br><button class="btn btn-s" onclick="closeModal()">Ø¨Ø³ØªÙ†</button></div></div>
    <div class="mod" id="dlIos" onclick="if(event.target===this)closeModal()"><div class="mbox"><h3>Ø¢ÛŒÙÙˆÙ†</h3><br><a href="https://apps.apple.com/us/app/streisand/id6450534064" class="btn btn-s" target="_blank" style="margin-bottom:10px">Streisand</a><a href="https://apps.apple.com/us/app/v2box-v2ray-client/id6446814690" class="btn btn-s" target="_blank">V2Box</a><br><br><button class="btn btn-s" onclick="closeModal()">Ø¨Ø³ØªÙ†</button></div></div>
    <div class="mod" id="dlWin" onclick="if(event.target===this)closeModal()"><div class="mbox"><h3>ÙˆÛŒÙ†Ø¯ÙˆØ²</h3><br><a href="https://github.com/2dust/v2rayN/releases" class="btn btn-s" target="_blank" style="margin-bottom:10px">v2rayN</a><a href="https://github.com/hiddify/hiddify-next/releases" class="btn btn-s" target="_blank">Hiddify</a><br><br><button class="btn btn-s" onclick="closeModal()">Ø¨Ø³ØªÙ†</button></div></div>

    <script>
        var subUrl = '{{ subscription_url }}';
        var total = parseInt('{{ user.data_limit }}') || 0;
        var used = parseInt('{{ user.used_traffic }}') || 0;
        var expire = '{{ user.expire }}';

        {% raw %}
        // INIT
        if (!subUrl || subUrl.includes('{{')) subUrl = window.location.href;
        document.getElementById('qrImg').src = 'https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=' + subUrl;

        // THEME
        var root = document.documentElement;
        var tBtn = document.getElementById('themeBtn');
        var isDark = localStorage.getItem('theme') === 'dark';
        
        function applyTheme() {
            if (isDark) { root.classList.add('dark'); tBtn.innerText = 'â˜€ï¸'; document.getElementById('themeColor').content = '#0f172a'; }
            else { root.classList.remove('dark'); tBtn.innerText = 'ğŸŒ™'; document.getElementById('themeColor').content = '#f8fafc'; }
        }
        applyTheme();

        tBtn.onclick = function() {
            isDark = !isDark;
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            applyTheme();
        };

        // DATA FORMAT
        function formatBytes(bytes) {
            if (bytes === 0) return '0 MB';
            if (total === 0) return 'Ù†Ø§Ù…Ø­Ø¯ÙˆØ¯';
            var k = 1024, sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            var i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // CALCULATE
        var percent = total > 0 ? Math.min((used/total)*100, 100) : 0;
        document.getElementById('usageFill').style.width = percent + '%';
        document.getElementById('usageTxt').innerText = Math.round(percent) + '%';
        document.getElementById('usageLbl').innerText = formatBytes(used) + ' / ' + formatBytes(total);
        
        if(percent > 90) document.getElementById('usageFill').style.background = '#ef4444';
        else if(percent > 70) document.getElementById('usageFill').style.background = '#f97316';

        document.getElementById('totalVol').innerText = formatBytes(total);
        document.getElementById('usedVol').innerText = formatBytes(used);
        document.getElementById('remVol').innerText = formatBytes(total - used);

        // DATE
        var dateTxt = 'Ù†Ø§Ù…Ø­Ø¯ÙˆØ¯'; var datePer = 100;
        if (expire && expire !== 'None' && expire !== '0') {
            var expD = new Date(expire.includes('-') ? expire : expire * 1000);
            if (!isNaN(expD)) {
                var diff = (expD - new Date()) / (1000 * 3600 * 24);
                if (diff < 0) { dateTxt = 'Ù…Ù†Ù‚Ø¶ÛŒ'; datePer = 0; }
                else { dateTxt = Math.ceil(diff) + ' Ø±ÙˆØ²'; datePer = Math.min((diff/30)*100, 100); }
                document.getElementById('expDate').innerHTML = expD.toLocaleDateString('fa-IR') + '<br><small style="font-size:11px;color:' + (diff<0?'#ef4444':'#10b981') + '">' + dateTxt + '</small>';
            }
        } else {
            document.getElementById('expDate').innerText = 'Ù†Ø§Ù…Ø­Ø¯ÙˆØ¯';
        }
        
        document.getElementById('timeFill').style.width = datePer + '%';
        document.getElementById('timeTxt').innerText = (dateTxt==='Ù†Ø§Ù…Ø­Ø¯ÙˆØ¯' ? 'âˆ' : Math.round(datePer)+'%');
        document.getElementById('timeLbl').innerText = dateTxt;

        // FUNCTIONS
        function copy(text, btn) {
            if(!text || text.includes('{{')) text = subUrl;
            var cph = document.getElementById('cph');
            cph.value = text; cph.select(); cph.setSelectionRange(0, 99999);
            try {
                if(navigator.clipboard) navigator.clipboard.writeText(text);
                document.execCommand('copy');
                showToast();
                if(btn) {
                    var org = btn.innerHTML;
                    btn.innerHTML = 'Ú©Ù¾ÛŒ Ø´Ø¯! âœ“';
                    setTimeout(() => btn.innerHTML = org, 1500);
                }
            } catch(e) {}
        }

        function showToast() {
            var t = document.getElementById('toast');
            t.classList.add('sh'); setTimeout(() => t.classList.remove('sh'), 2000);
        }

        function modal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal() { document.querySelectorAll('.mod').forEach(m => m.style.display='none'); }

        function openUri(app) {
            var n = document.title;
            if(app==='v2rayng') window.location = 'v2rayng://install-sub?url='+encodeURIComponent(subUrl)+'&name='+encodeURIComponent(n);
            else if(app==='hiddify') window.location = 'hiddify://install-sub?url='+encodeURIComponent(subUrl)+'&name='+encodeURIComponent(n);
            else if(app==='streisand') window.location = 'streisand://import/'+subUrl;
            closeModal();
        }

        function setTab(id) {
            document.querySelectorAll('.tab').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('tab-'+id).classList.add('active');
        }

        // Highlight recommended
        var ua = navigator.userAgent.toLowerCase();
        if(ua.includes('android')) document.getElementById('dl-and').style.background = 'rgba(14,165,233,0.1)';
        else if(ua.includes('iphone') || ua.includes('ipad')) document.getElementById('dl-ios').style.background = 'rgba(14,165,233,0.1)';
        else if(ua.includes('win')) document.getElementById('dl-win').style.background = 'rgba(14,165,233,0.1)';
        {% endraw %}
    </script>
</body>
</html>